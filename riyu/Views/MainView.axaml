<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:riyu.ViewModels"
             xmlns:views="clr-namespace:riyu.Views"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="riyu.Views.MainView"
             x:DataType="vm:MainViewModel"
             Background="#fffaf7"
             FontFamily="{DynamicResource HarmonyOSBold}"
             Focusable="True">
  <Design.DataContext>
    <!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
    <vm:MainViewModel />
  </Design.DataContext>

  <Grid>
    <!-- 数据加载中指示器 -->
    <StackPanel Spacing="16" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                IsVisible="{Binding IsLoadingData}">
      <TextBlock Text="正在加载数据..."
                 FontSize="16"
                 Foreground="#666666"
                 HorizontalAlignment="Center"
                 FontFamily="{DynamicResource HarmonyOSRegular}"/>
    </StackPanel>
    
    <!-- 有导入数据时显示完整界面 -->
    <StackPanel Spacing="40" 
                HorizontalAlignment="Center" 
                VerticalAlignment="Center">
      <StackPanel.IsVisible>
        <MultiBinding Converter="{StaticResource AndBooleanConverter}">
          <Binding Path="HasImportedData"/>
          <Binding Path="IsLoadingData" Converter="{StaticResource InvertBooleanConverter}"/>
        </MultiBinding>
      </StackPanel.IsVisible>
        
        <!-- 中间内容区域 -->
        <StackPanel Spacing="16" 
                    HorizontalAlignment="Center">
          
          <!-- 中文释义和词性 - 只在有数据时显示 -->
          <StackPanel Orientation="Horizontal" 
                      HorizontalAlignment="Center" 
                      Spacing="12" 
                      VerticalAlignment="Center"
                      Margin="0,-150,0,0"
                      IsVisible="{Binding HasImportedData}">
            
            <!-- 中文释义文本框 -->
            <TextBlock Text="{Binding ChineseTranslation}"
                       FontSize="32"
                       FontWeight="Bold"
                       Foreground="#2d2d2d"
                       FontFamily="{DynamicResource HarmonyOSBold}"
                       VerticalAlignment="Center"/>
            
            <!-- 词性标签 - 只在有词性时显示 -->
            <Border Background="#f0f0f0"
                    CornerRadius="6"
                    Padding="8,4"
                    VerticalAlignment="Center"
                    IsVisible="{Binding IsWordTypeVisible}">
              <TextBlock Text="{Binding WordType}"
                         FontSize="12"
                         FontWeight="Medium"
                         Foreground="#666666"
                         FontFamily="{DynamicResource HarmonyOSMedium}"/>
            </Border>
          </StackPanel>
          
          <!-- 确定按钮 -->
          <Button Classes="confirm-button"
                  Command="{Binding ConfirmAnswerCommand}"
                  HorizontalAlignment="Center"
                  FontFamily="{DynamicResource HarmonyOSMedium}"
                  Margin="0,-70,0,0">
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
              <!-- 确定状态：文本+图标作为一个整体 -->
              <StackPanel Orientation="Horizontal" 
                         Spacing="4"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         IsVisible="{Binding !IsDictationCompleted}">
                <TextBlock Text="确定" 
                          VerticalAlignment="Center"
                          Foreground="White"
                          FontSize="14"
                          FontWeight="Medium"/>
                <Image Source="{StaticResource ConfirmIcon}" 
                      Width="12" 
                      Height="12" 
                      Stretch="Uniform"
                      VerticalAlignment="Center"
                      Margin="2,-1,0,0"/>
              </StackPanel>
              
              <!-- 再来一次状态：单独的文本 -->
              <TextBlock Text="再来一次" 
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Foreground="White"
                        FontSize="14"
                        FontWeight="Medium"
                        IsVisible="{Binding IsDictationCompleted}"/>
            </Grid>
          </Button>
          
          <!-- 输入框 -->
          <TextBox Text="{Binding JapaneseInput}"
                   Watermark="输入日语单词..."
                   Classes="underlineTextBox"
                   Width="{OnPlatform Default=400, Android=300}"
                   HorizontalAlignment="Center"
                   FontFamily="{DynamicResource HarmonyOSRegular}"
                   KeyDown="OnJapaneseInputKeyDown"/>
          
          <!-- 控制按钮区域 -->
          <StackPanel Orientation="Horizontal" 
                      HorizontalAlignment="Center" 
                      Spacing="20" 
                      Margin="0,20,0,0">
            
            <!-- 上一个按钮 -->
            <Button Width="40" 
                    Height="40" 
                    Classes="control-button"
                    Command="{Binding NavigateToPreviousWordCommand}">
              <PathIcon Data="{StaticResource ShangyigeIcon}" 
                        Width="24" 
                        Height="24" 
                        Foreground="#2d2d2d"/>
            </Button>
            
            <!-- 播放/暂停按钮 -->
            <Button Width="40" 
                    Height="40" 
                    Classes="control-button"
                    Command="{Binding TogglePlayCommand}">
              <Grid>
                <!-- 播放图标 - 当未播放时显示 -->
                <PathIcon Data="{StaticResource BofangIcon}" 
                          Width="24" 
                          Height="24" 
                          Foreground="#2d2d2d"
                          IsVisible="{Binding !IsPlaying}"/>
                <!-- 暂停图标 - 当播放时显示 -->
                <PathIcon Data="{StaticResource ZantingIcon}" 
                          Width="24" 
                          Height="24" 
                          Foreground="#2d2d2d"
                          IsVisible="{Binding IsPlaying}"/>
              </Grid>
            </Button>
            
            <!-- 下一个按钮 -->
            <Button Width="40" 
                    Height="40" 
                    Classes="control-button"
                    Command="{Binding NavigateToNextWordCommand}">
              <PathIcon Data="{StaticResource XiayigeIcon}" 
                        Width="24" 
                        Height="24" 
                        Foreground="#2d2d2d"/>
            </Button>
            
          </StackPanel>
          
          <!-- 进度条和页码 - 使用Grid实现更好的布局 -->
          <Grid Width="{OnPlatform Default=500, Android=320}" HorizontalAlignment="Center" Margin="0,10,0,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- 进度条 - 第一列 -->
            <ProgressBar Grid.Column="0"
                         Value="{Binding Progress}" 
                         Maximum="1.0"
                         Classes="wordProgress"/>
            
            <!-- 页码 - 第二列 -->
            <TextBlock Grid.Column="1"
                       Text="{Binding PageDisplay}"
                       Classes="pageNumber"
                       Margin="10,5,0,0"
                       VerticalAlignment="Center"/>
          </Grid>
          
        </StackPanel>
        
        <!-- 导入Excel按钮 -->
        <Button Content="导入Excel文件"
                Command="{Binding SelectExcelFileCommand}"
                Classes="import-button"
                HorizontalAlignment="Center"
                FontFamily="{DynamicResource HarmonyOSMedium}"
                IsVisible="{Binding IsLoadingData, Converter={StaticResource InvertBooleanConverter}}"/>
        
    </StackPanel>

    <!-- 无导入数据时只显示导入界面 -->
    <StackPanel HorizontalAlignment="Center" 
                VerticalAlignment="Center"
                Spacing="40">
      <StackPanel.IsVisible>
        <MultiBinding Converter="{StaticResource AndBooleanConverter}">
          <Binding Path="HasImportedData" Converter="{StaticResource InvertBooleanConverter}"/>
          <Binding Path="IsLoadingData" Converter="{StaticResource InvertBooleanConverter}"/>
        </MultiBinding>
      </StackPanel.IsVisible>
        
        <!-- 欢迎标题 -->
        <StackPanel HorizontalAlignment="Center" 
                    Spacing="16">
            <TextBlock Text="欢迎使用日语单词斩"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="#2d2d2d"
                       FontFamily="{DynamicResource HarmonyOSBold}"
                       HorizontalAlignment="Center"/>
            
            <TextBlock Text="请先导入Excel文件开始学习"
                       FontSize="16"
                       Foreground="#666666"
                       FontFamily="{DynamicResource HarmonyOSRegular}"
                       HorizontalAlignment="Center"/>
        </StackPanel>
        
        <!-- 导入Excel按钮 -->
        <Button Content="导入Excel文件"
                Command="{Binding SelectExcelFileCommand}"
                Classes="import-button"
                HorizontalAlignment="Center"
                FontFamily="{DynamicResource HarmonyOSMedium}"
                IsVisible="{Binding IsLoadingData, Converter={StaticResource InvertBooleanConverter}}"/>
        
    </StackPanel>

    <!-- 右下角单词表按钮 - 只在有数据且非加载状态时显示 -->
    <Button Content="单词表"
            Classes="word-list-button"
            Command="{Binding ShowWordListDialogCommand}"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="{OnPlatform Default='0,0,20,20', Android='0,0,20,40'}"
            FontFamily="{DynamicResource HarmonyOSBold}"
            IsVisible="{Binding HasImportedData}"/>

  </Grid>

</UserControl>
